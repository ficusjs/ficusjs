class s{constructor(){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.eventBus)return globalThis.__ficusjs__.eventBus;this.subscribers={},globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.eventBus=globalThis.__ficusjs__.eventBus||this}getSubscribers(s){return s?this.subscribers[s]:this.subscribers}subscribe(s,e,t={}){const u=this,i={callCount:0,fireOnce:!1,...t};u.subscribers[s]||(u.subscribers[s]=new Map);return u.subscribers[s].set(e,i),()=>{const t=new Map;u.subscribers[s].forEach(((s,u)=>u!==e&&t.set(u,s))),u.subscribers[s]=t}}publish(s,e){if(!this.subscribers[s])return[];const t=new Map;return this.subscribers[s].forEach(((s,u)=>{s.fireOnce&&1===s.callCount||(u(e),++s.callCount,t.set(u,s))})),t}}function createEventBus(){return new s}function getEventBus(){return createEventBus()}function withEventBus(s,e){return{...e,created(){this.setEventBus(s),e.created&&e.created.call(this)},mounted(){this._subscribeToEventBus(),e.mounted&&e.mounted.call(this)},updated(){this._subscribeToEventBus(),e.updated&&e.updated.call(this)},removed(){this._unsubscribeFromEventBus(),e.removed&&e.removed.call(this)},setEventBus(s){const e=this;e._eventBus=s,e._eventSubscriptions={},e.eventBus={subscribe:(s,t,u)=>(e._eventSubscriptions[s]={unsubscribe:e._eventBus.subscribe(s,t,u),callback:t,options:u},function(){const{unsubscribe:t}=e._eventSubscriptions[s];t&&t(),e._eventSubscriptions[s].unsubscribe=null}),publish(s,t={}){e._eventBus.publish(s,t)},getSubscribers:s=>e._eventBus.getSubscribers(s)}},_subscribeToEventBus(){for(const s in this._eventSubscriptions){const{unsubscribe:e,callback:t,options:u}=this._eventSubscriptions[s];e||(this._eventSubscriptions[s].unsubscribe=this._eventBus.subscribe(s,t,u))}},_unsubscribeFromEventBus(){for(const s in this._eventSubscriptions){const{unsubscribe:e}=this._eventSubscriptions[s];e&&e(),this._eventSubscriptions[s].unsubscribe=null}}}}export{createEventBus,getEventBus,withEventBus};
