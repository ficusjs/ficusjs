function toKebabCase(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}function elementRenderer(t,e){for(;e.firstChild;)e.removeChild(e.firstChild);let s;if("string"==typeof t)s=document.createElement("div"),s.innerHTML=t;else{if(!t.nodeName)throw new Error(`Unable to render ${t}. Have you included a renderer function?`);s=t}s&&e.appendChild(s)}function createCustomElement(t,e){const s=function(t){if(!t)return[];const e=[];return Object.keys(t).forEach((s=>{(null==t[s].observed||t[s].observed)&&e.push(toKebabCase(s))})),e}(e.props);globalThis.customElements.get(t)||globalThis.customElements.define(t,class extends globalThis.HTMLElement{static get observedAttributes(){return s}get componentTagName(){return t}connectedCallback(){null==this.connectedCallbackCount&&(this.connectedCallbackCount=0),this.connectedCallbackCount=this.connectedCallbackCount+1,this._checkInit(),this._preprocess()}disconnectedCallback(){"function"==typeof this.removed&&(this.removed(),this.isRemovedCalled=!0)}attributeChangedCallback(){null!=this.connectedCallbackCount&&(this._checkInit(),this._preprocess())}get initialised(){return this._props&&this._computed&&this.templateRenderer}_checkInit(){this.initialised||this._init(e)}_init(e){this.ficusCustomElement=t,this._props=e.props||{},this._computed=e.computed||{},this.computedCache={},this.status="render",this.connectedCallbackCount=0,this.props=this._processProps(),this.root=this._processRoot(e.root),this.slots=this._processSlots(),this.render=e.render||null,this.templateRenderer=e.renderer||elementRenderer,this.template=null,this.created=e.created||null,this.mounted=e.mounted||null,this.updated=e.updated||null,this.removed=e.removed||null,this.isCreatedCalled=!1,this.isMountedCalled=!1,this.isRemovedCalled=!1,this.emit=(t,e)=>{!function(t,e,s={}){const i=Object.assign({},{bubbles:!0,cancelable:!0,composed:!1},s),r=globalThis.document.createEvent("CustomEvent");r.initCustomEvent(e,i.bubbles,i.cancelable,i.detail),Object.defineProperty(r,"composed",{value:i.composed}),t.dispatchEvent(r)}(this,t,{detail:e})},this._processMethodsAndComputedProps(e),this._processInstanceProps(this._props),"function"!=typeof this.created||this.isCreatedCalled||(this.created(),this.isCreatedCalled=!0)}_processProps(){const t={};return Object.keys(this._props).forEach((e=>{const s={},i=this._props[e],r=this._getAttribute(e);let n=null;if(null!=i.default&&(n=i.default),i.required&&null==r)null!=n?(console.info(`No biggie, the required prop '${e}' has no value set, so the default has been set`),s[e]=n):(s[e]=null,console.error(`The required prop '${e}' has no value set`));else switch(i.type){case String:default:s[e]=r||n;break;case Number:s[e]=null!=r?parseFloat(r):null!=n?n:0;break;case Boolean:s[e]=null!=r?"true"===r.toString():null!=n&&n;break;case Object:try{s[e]=null!=r?JSON.parse(r):null!=n?n:void 0}catch(t){s[e]=null!=n?n:void 0,console.error(`An object prop parse issue occurred with prop ${e} and value ${r}`)}}t[e]=s[e],this._instanceProps&&this._instanceProps[e]&&(t[e]=this._instanceProps[e])})),t}_processMethodsAndComputedProps(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]||"function"!=typeof t[s]||(e[s]=t[s].bind(e)),"computed"===s&&this._processComputed(t[s])}))}_processRoot(t){switch(t){case"standard":default:return this;case"shadow":return this.attachShadow({mode:"open"});case"shadow:closed":return this.attachShadow({mode:"closed"})}}_processComputed(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]?console.warn(`Computed property '${s}' already exists on the component instance`):Object.defineProperty(e,s,{get:()=>(e.computedCache[s]||(e.computedCache[s]=t[s].bind(e)()),e.computedCache[s])})}))}_processRender(){const t=this.render?this.render():void 0;t&&(this.template=t,this._updateRender())}_processSlots(){const t=this.childNodes,e={default:[]};return t.length>0&&[...t].forEach((t=>{const s=t.getAttribute?t.getAttribute("slot"):null;s?e[s]=t:e.default.push(t)})),e}_getAttribute(t){try{return this.getAttribute(toKebabCase(t))}catch(t){return console.error("A get prop error occurred",t),""}}_processInstanceProps(t){const e=this,s=Object.keys(t);t&&s.forEach((t=>{let s;e[t]&&(s=e[t],delete e[t]),Object.defineProperty(e,t,{get(){return this._instanceProps&&this._instanceProps[t]?this._instanceProps[t]:this.getAttribute(toKebabCase(t))},set(e){return this._instanceProps||(this._instanceProps={}),this._instanceProps[t]=e,this.setAttribute(toKebabCase(t),"object"==typeof e?JSON.stringify(e):e.toString()),!0},enumerable:!0}),s&&(e[t]=s)}))}_preprocess(){this.computedCache={},this.props=this._processProps(),this._processRender()}_updateRender(){var t;this.template&&("object"!=typeof(t=this.template)&&"function"!=typeof t||"function"!=typeof t.then?(this.templateRenderer(this.template,this.root),this._callLifecycleMethods()):this.template.then((t=>{this.templateRenderer(t,this.root),this._callLifecycleMethods()})).catch((t=>console.error("A component render error occurred",t))))}_callLifecycleMethods(){"function"!=typeof this.mounted||this.isMountedCalled||this.mounted(),this.isMountedCalled=!0,"function"==typeof this.updated&&this.isMountedCalled&&this.updated()}})}function isPromise$1(t){return("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}function withLocalState(t){return{...t,created(){if(t.state&&"function"!=typeof t.state)throw new Error("State must be a function!");this._state=t.state||{},"function"==typeof this._state&&(this._state=this._state.bind(this)()),this.state=this._monitorState(this._state),this.setState=(t,e)=>{const setter=t=>{if(!t||"object"!=typeof t)return;const s=this.updated;e&&(this.updated=()=>{e(),this.updated=s||void 0}),this.status="transaction";for(const e in t)this.state[e]&&this.state[e]===t[e]||(this.state[e]=t[e]);this.status="render",this._processRender()},s=t(this.state);isPromise$1(s)?s.then(setter):setter(s)},t.created&&t.created.call(this)},_monitorState(t){const e=this;return new Proxy(t,{set:(t,s,i)=>(t[s]===i||(t[s]=i,e.computedCache={},"render"===e.status&&e._processRender()),!0)})}}}function createComponent(t,e){createCustomElement(t,withLocalState(e))}function withEventBus(t,e){return{...e,created(){this.setEventBus(t),e.created&&e.created.call(this)},mounted(){this._subscribeToEventBus(),e.mounted&&e.mounted.call(this)},updated(){this._subscribeToEventBus(),e.updated&&e.updated.call(this)},removed(){this._unsubscribeFromEventBus(),e.removed&&e.removed.call(this)},setEventBus(t){const e=this;e._eventBus=t,e._eventSubscriptions={},e.eventBus={subscribe:(t,s,i)=>(e._eventSubscriptions[t]={unsubscribe:e._eventBus.subscribe(t,s,i),callback:s,options:i},function(){const{unsubscribe:s}=e._eventSubscriptions[t];s&&s(),e._eventSubscriptions[t].unsubscribe=null}),publish(t,s={}){e._eventBus.publish(t,s)},getSubscribers:t=>e._eventBus.getSubscribers(t)}},_subscribeToEventBus(){for(const t in this._eventSubscriptions){const{unsubscribe:e,callback:s,options:i}=this._eventSubscriptions[t];e||(this._eventSubscriptions[t].unsubscribe=this._eventBus.subscribe(t,s,i))}},_unsubscribeFromEventBus(){for(const t in this._eventSubscriptions){const{unsubscribe:e}=this._eventSubscriptions[t];e&&e(),this._eventSubscriptions[t].unsubscribe=null}}}}function withStateTransactions(t){return{...t,created(){this.state=this._monitorTransactionState(this._state),this.setState=(t,e)=>{const setter=t=>{if(!t||"object"!=typeof t)return;const s=this.transaction,i=this.updated;e&&(this.updated=()=>{setTimeout(e),this.updated=i||void 0}),s||this.beginTransaction();for(const e in t)this.state[e]&&this.state[e]===t[e]||(this.state[e]=t[e]);s||this.endTransaction()},s=t(this.state);var i;"object"!=typeof(i=s)&&"function"!=typeof i||"function"!=typeof i.then?setter(s):s.then(setter)},t.created&&t.created.call(this)},beginTransaction(){this.transactionCache={},this.transaction=!0,this.status="transaction"},endTransaction(){this.transaction=!1,this.status="render",this._processRender()},rollbackTransaction(){Object.keys(this.transactionCache).forEach((t=>this.state[t]=this.transactionCache[t])),this.endTransaction()},_monitorTransactionState(t){const e=this;return new Proxy(t,{set:(t,s,i)=>(t[s]===i||(e.transaction&&!e.transactionCache[s]&&(e.transactionCache[s]=e._copyValue(t[s])),t[s]=i,e.computedCache={},"render"===e.status&&e._processRender()),!0),get:(t,e)=>t[e]})},_copyValue:t=>JSON.parse(JSON.stringify(t))}}function withLazyRender(t){return{...t,created(){t.created&&t.created.call(this),this.elementVisible=!1,this.intersectionObserver=new IntersectionObserver(((t,e)=>{t.forEach((t=>{t.isIntersecting&&!this.elementVisible&&(this.elementVisible=!0,this.intersectionObserver.disconnect(),this._processRender())}))}),{threshold:.1}),this.intersectionObserver.observe(this)},removed(){t.removed&&t.removed.call(this),this.intersectionObserver&&this.intersectionObserver.disconnect()}}}function withBreakpointRender(t,e){return{...e,created(){this.setBreakpointConfig(t),e.created&&e.created.call(this)},mounted(){this._addBreakpointListeners(),e.mounted&&e.mounted.call(this)},updated(){this._addBreakpointListeners(),e.updated&&e.updated.call(this)},removed(){this._removeBreakpointListeners(),e.removed&&e.removed.call(this)},_addBreakpointListeners(){const t=this;t._breakpointConfig&&t._breakpointConfig.reactive&&t._breakpointListeners.forEach((t=>{if(!t.listenerSubscribed){const e=window.matchMedia(t.query);e.addEventListener("change",t.listener),t.mediaQueryList=e,t.listenerSubscribed=!0}}))},_removeBreakpointListeners(){const t=this;t._breakpointListeners&&t._breakpointListeners.forEach((t=>{t.mediaQueryList&&(t.mediaQueryList.removeEventListener("change",t.listener),t.listenerSubscribed=!1)}))},setBreakpointConfig(t){const e=this;e._breakpointConfig=t;const s=Object.keys(t.breakpoints).sort(((t,e)=>t-e)),i=s.map(((i,r)=>{let n;0===r?n=`only screen and (max-width: ${i}px)`:r===s.length-1?(n=`only screen and (min-width: ${parseInt(s[r-1],10)+1}px) and (max-width: ${i}px)`,n=`only screen and (min-width: ${parseInt(i,10)+1}px)`):n=`only screen and (min-width: ${parseInt(s[r-1],10)+1}px) and (max-width: ${i}px)`;const a=t.breakpoints[i].method;return{query:n,method:a,listener(t){t.matches&&e[a]&&(e.render=e[a],e._processRender())},mediaQueryList:void 0,listenerSubscribed:!1}}));e._removeBreakpointListeners(),this._breakpointListeners=i,e._addBreakpointListeners(),i.forEach((t=>{t.mediaQueryList.matches&&e[t.method]&&(e.render=e[t.method])}))}}}function withStyles(t){return{...t,created(){t.styles&&"function"==typeof t.styles&&(globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.styles=globalThis.__ficusjs__.styles||{},this._injectStyles(t.styles())),t.created&&t.created.call(this)},_isStyleSheet:t=>"object"==typeof t&&t.tagName&&"style"===t.tagName.toLowerCase(),async _injectStyles(t){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.styles&&globalThis.__ficusjs__.styles[this.componentTagName])return;if(globalThis.__ficusjs__.styles[this.componentTagName]={loaded:!1},Array.isArray(t)&&t.filter((t=>"string"!=typeof t&&!this._isStyleSheet(t))).length||!Array.isArray(t)&&"string"!=typeof t&&!this._isStyleSheet(t))return void console.error("Dude, styles must return a CSS string or an array of CSS strings!");let e;e=Array.isArray(t)?await Promise.all(t.map((t=>this._processStyle(t,this.componentTagName)))):await this._processStyle(t,this.componentTagName),globalThis.__ficusjs__.styles[this.componentTagName].styles=e,globalThis.__ficusjs__.styles[this.componentTagName].loaded=!0,this.areStylesInjected=!0},_injectStylesheet(t){document.getElementsByTagName("head")[0].appendChild(t)},async _processStyle(t,e){if(this._isStyleSheet(t))return t.setAttribute("data-tag",e),this._injectStylesheet(t),t;if(/http[s]?:\/\/.+\.css$/.test(t)){const s=document.createElement("link");return s.rel="stylesheet",s.type="text/css",s.href=t,s.setAttribute("data-tag",e),document.head.appendChild(s),s}return/.+\.css$/.test(t)?globalThis.fetch(t).then((t=>t.text())).then((t=>this._createAndInjectStylesheet(t,{"data-tag":e}))):this._createAndInjectStylesheet(t,{"data-tag":e})},_createAndInjectStylesheet(t,e){const s=this._createStyle(t);return this._setElementAttributes(s,e),this._injectStylesheet(s),s},_createStyle(t){const e=document.createElement("style");return e.appendChild(document.createTextNode(t)),e},_setElementAttributes(t,e){e&&Object.keys(e).forEach((s=>{t.setAttribute(s,e[s])}))}}}function withI18n(t,e){return{...e,created(){this.setI18n(t),e.created&&e.created.call(this)},setI18n(t){const e=this;e._i18n=t,e.i18n={t:(t,s,i)=>e._i18n.t(t,s,i),getLocale:()=>e._i18n.getLocale()}}}}function withStore(t,e){return{...e,created(){this._subscribeCallback=()=>{this.computedCache={},this._processRender()},this.setStore(t),e.created&&e.created.call(this)},mounted(){this._subscribeToStores(!1),e.mounted&&e.mounted.call(this)},updated(){this._subscribeToStores(!1),e.updated&&e.updated.call(this)},removed(){this._unsubscribeFromStores(),e.removed&&e.removed.call(this)},setStore(t){this.store=t,this._subscribeToStores()},_subscribeToStores(t=!0){if(this.store&&this.store.subscribe&&"function"==typeof this.store.subscribe&&!this.unsubscribe)this.unsubscribe=this.store.subscribe(this._subscribeCallback),t&&this._subscribeCallback();else if(this.store&&"object"==typeof this.store&&!this.store.subscribe){this.unsubscribe={};Object.keys(this.store).forEach((t=>{this.store[t]&&this.store[t].subscribe&&"function"==typeof this.store[t].subscribe&&!this.unsubscribe[t]&&(this.unsubscribe[t]=this.store[t].subscribe(this._subscribeCallback))})),t&&this._subscribeCallback()}},_unsubscribeFromStores(){if(this.store&&this.unsubscribe&&"object"==typeof this.unsubscribe){Object.keys(this.unsubscribe).forEach((t=>{this.unsubscribe[t]()})),this.unsubscribe=null}else this.store&&this.unsubscribe&&"function"==typeof this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}}}function withWorkerStore(t,e){return{...e,created(){const s=this;if(s.worker=t,globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.workers=globalThis.__ficusjs__.workers||new Map,globalThis.__ficusjs__.workers.has(t)){const e=globalThis.__ficusjs__.workers.get(t);e.has(s)||e.add(s)}else{const e=new Set;e.add(s),globalThis.__ficusjs__.workers.set(t,e)}t.onmessage||(s.worker.onmessage=e=>{const s=globalThis.__ficusjs__.workers.get(t);for(const t of s)t.state=e.data,t.computedCache={},t._processRender.apply(t)}),s.store={dispatch(t,e){s.worker.postMessage({actionName:t,payload:e})}},e.created&&e.created.call(s)}}}const t=Object.freeze({INIT:-1,NOT_STARTED:0,RUNNING:1,STOPPED:2});function withXStateService(e,s){return{...s,created(){this._subscribeCallback=()=>{this.computedCache={},this._processRender()},this.setXStateService(e),s.created&&s.created.call(this)},mounted(){this._subscribeToFsmService(!1),s.mounted&&s.mounted.call(this)},updated(){this._subscribeToFsmService(!1),s.updated&&s.updated.call(this)},removed(){this._unsubscribeFromFsmService(),s.removed&&s.removed.call(this)},setXStateService(e){this.fsm=e&&e.status!==t.INIT?e:function(e){return{_xstateService:e,get status(){return this._xstateService?this._xstateService.status:t.INIT},get state(){return this._xstateService.state},subscribe(t){return this._xstateService.subscribe(t)},send(t){this._xstateService.send(t)},start(){this._xstateService.start()}}}(e),this._fsmSubscriptionCallback=()=>{this.fsm.status===t.RUNNING&&this._fsmSubscription&&this._subscribeCallback()},this._subscribeToFsmService()},_startFsmService(){this.fsm&&this._fsmSubscription&&this.fsm.status===t.NOT_STARTED&&this.fsm.start()},_subscribeToFsmService(e=!0){this.fsm&&this.fsm.status!==t.INIT&&!this._fsmSubscription&&(this._fsmSubscription=this.fsm.subscribe(this._fsmSubscriptionCallback),e&&this._fsmSubscriptionCallback(),this._startFsmService())},_unsubscribeFromFsmService(){this.fsm&&this.fsm.status!==t.INIT&&this._fsmSubscription&&"function"==typeof this._fsmSubscription&&(this._fsmSubscription(),this._fsmSubscription=null)}}}class e{constructor(){this.extensions={}}withBreakpointRender(t){return this.extensions[withBreakpointRender]={func:withBreakpointRender,arg:t},this}withEventBus(t){return this.extensions[withEventBus]={func:withEventBus,arg:t},this}withI18n(t){return this.extensions[withI18n]={func:withI18n,arg:t},this}withLazyRender(){return this.extensions[withLazyRender]={func:withLazyRender,arg:void 0},this}withStyles(){return this.extensions[withStyles]={func:withStyles,arg:void 0},this}withLocalState(){return this.extensions[withLocalState]={func:withLocalState,arg:void 0},this}withStore(t){return this.extensions[withStore]={func:withStore,arg:t},this}withWorkerStore(t){return this.extensions[withWorkerStore]={func:withWorkerStore,arg:t},this}withXStateService(t){return this.extensions[withXStateService]={func:withXStateService,arg:t},this}create(t){return Object.keys(this.extensions).reduce(((t,e)=>{const s=this.extensions[e];return s.arg?s.func(s.arg,t):s.func(t)}),t)}}const s={newInstance:()=>new e};class i{constructor(t){this.machine=t}get initialState(){return this.machine.initial||Object.keys(this.machine.states)[0]}transition(t,e){return this.machine.states[t].on[e]}}function withStateMachine(t,e){return{...e,created(){this._stateMachineDefinition=t,this._stateMachine=new i(t),this.initialState=this._stateMachine.initialState,this.state={context:{},matches(t){return t===this.value},value:this.initialState},this.setState=(t,e)=>{if(!t||"object"!=typeof t)return;const s=this.updated;e&&(this.updated=()=>{e.call(this),this.updated=s||void 0}),this.status="transaction";for(const e in t)"value"===e?this.state[e]=t[e]:this.state.context[e]&&this.state.context[e]===t[e]||(this.state.context[e]=t[e]);this.status="render",this._processRender()},e.created&&e.created.call(this)},send(t){let e,s;if("string"==typeof t)e=t;else{const{type:i,...r}=t;e=i,s=r}const{value:i}=this.state,r=this._stateMachine.transition(i,e)||i,n="object"==typeof r&&r.target?r.target:r,a="object"==typeof r&&r.action?r.action:r,o=this._stateMachineDefinition.actions&&this._stateMachineDefinition.actions[a]?()=>this._stateMachineDefinition.actions[a].call(this,s):()=>{};this.setState({value:n},o)}}}class r{constructor(){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.eventBus)return globalThis.__ficusjs__.eventBus;this.subscribers={},globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.eventBus=globalThis.__ficusjs__.eventBus||this}getSubscribers(t){return t?this.subscribers[t]:this.subscribers}subscribe(t,e,s={}){const i=this,r={callCount:0,fireOnce:!1,...s};i.subscribers[t]||(i.subscribers[t]=new Map);return i.subscribers[t].set(e,r),()=>{const s=new Map;i.subscribers[t].forEach(((t,i)=>i!==e&&s.set(i,t))),i.subscribers[t]=s}}publish(t,e){if(!this.subscribers[t])return[];const s=new Map;return this.subscribers[t].forEach(((t,i)=>{t.fireOnce&&1===t.callCount||(i(e),++t.callCount,s.set(i,t))})),s}}function createEventBus(){return new r}function getEventBus(){return createEventBus()}class n{constructor(t,e,s={}){this.namespace=t,this.storage=e,this.options=s,this._init()}_init(){if("performance"in globalThis&&this.options.clearOnReload){const t=globalThis.performance.getEntriesByType("navigation").map((t=>t.type));this.lastUpdated()&&t.includes("reload")&&this.removeState()}}setState(t){t?(this.storage.setItem(`${this.namespace}:state`,this._normalizeState(t)),this.storage.setItem(`${this.namespace}:lastUpdated`,(new Date).getTime().toString())):this.removeState()}_normalizeState(t){return"object"==typeof t&&this.options.saveState&&"function"==typeof this.options.saveState?JSON.stringify(this.options.saveState(t)):"string"!=typeof t?JSON.stringify(t):t}getState(){const t=this.storage.getItem(`${this.namespace}:state`);return t?JSON.parse(t):void 0}lastUpdated(){const t=this.storage.getItem(`${this.namespace}:lastUpdated`);return t?parseInt(t,10):void 0}removeState(){this.storage.removeItem(`${this.namespace}:state`),this.storage.removeItem(`${this.namespace}:lastUpdated`)}}function createPersist(t,e="session",s){return new n(t,"local"===e?globalThis.localStorage:globalThis.sessionStorage,s)}class a{constructor(t){const e=this;e.getters={},e.actions={},e.mutations={},e.state={},e.getterCache={},e.status="resting",e.transaction=!1,e.transactionCache={},e.callbacks=[],t.getters&&(e.getters=new Proxy(t.getters||{},{get:(t,s)=>(e.getterCache[s]||(e.getterCache[s]=t[s](e.state)),e.getterCache[s])})),t.actions&&(e.actions=t.actions),t.mutations&&(e.mutations=t.mutations);let s=t.initialState||{};if(e.copyOfInitialState=e._copyValue(s),e.ttl=-1,e.lastUpdatedState={},t.ttl&&(e.ttl=t.ttl,Object.keys(e.copyOfInitialState).forEach((t=>e.lastUpdatedState[t]=(new Date).getTime()))),t.persist){e.persist="string"==typeof t.persist?createPersist(t.persist):t.persist;const i=e.persist.getState(),r=e.persist.lastUpdated();i&&r&&(-1===e.ttl||e._lastUpdatedTimeDiff(r)<e.ttl)&&(s=i)}this._processState(s)}_processState(t){const e=this;e.state=new Proxy(t,{set:(t,s,i)=>(e.transaction&&!e.transactionCache[s]&&(e.transactionCache[s]=e._copyValue(t[s])),t[s]=i,e.lastUpdatedState[s]=(new Date).getTime(),e.getterCache={},e.transaction||(e.persist&&e.persist.setState(e.state),e.status="resting",e._processCallbacks(e.state)),!0),get:(t,s)=>e.ttl>-1&&e._lastUpdatedTimeDiff(e.lastUpdatedState[s])>e.ttl?(e.persist&&e.persist.removeState(),e.copyOfInitialState[s]):t[s]})}_lastUpdatedTimeDiff(t){return Math.round(((new Date).getTime()-t)/1e3)}dispatch(t,e){return"function"!=typeof this.actions[t]?(console.error(`Dude, the store action "${t}" doesn't exist.`),!1):(this.status="action",this.actions[t](this,e))}commit(t,e){if("function"!=typeof this.mutations[t])return console.error(`Dude, the store mutation "${t}" doesn't exist`),!1;this.status="mutation";const s=this.mutations[t](this.state,e);return this.state=s,this.persist&&this.persist.setState(s),!0}_processCallbacks(t){return!(!this.callbacks.length||this.transaction)&&(this.callbacks.forEach((e=>e(t))),!0)}subscribe(t){if("function"!=typeof t)return console.error("Dude, you can only subscribe to store changes with a valid function"),!1;return this.callbacks.push(t),()=>{this.callbacks=this.callbacks.filter((e=>e!==t))}}_copyValue(t){return JSON.parse(JSON.stringify(t))}begin(){this.transactionCache={},this.transaction=!0}end(){this.transaction=!1,this._processCallbacks(this.state)}rollback(){Object.keys(this.transactionCache).forEach((t=>this.state[t]=this.transactionCache[t])),this.end()}clear(t=!0){this.getterCache={},this.transactionCache={},this.lastUpdatedState={},this.persist&&this.persist.removeState(),this.transaction=!0,this.status="clear";const e=this._copyValue(this.copyOfInitialState);for(const t in e)this.state[t]=e[t];this.transaction=!1,this.status="resting",t&&this._processCallbacks(this.state)}}function createStore(t,e){let s=getStore(t);return s||(s=new a(e),console.warn("createStore function is deprecated. Use createAppState and getAppState in v3.3.0 to create stores"),globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.store=globalThis.__ficusjs__.store||{},globalThis.__ficusjs__.store[t]=s,s)}function getStore(t){if(console.warn("getStore function is deprecated. Use createAppState and getAppState in v3.3.0 to create stores"),globalThis.__ficusjs__&&globalThis.__ficusjs__.store&&globalThis.__ficusjs__.store[t])return globalThis.__ficusjs__.store[t]}class o{constructor(t){const e=this;e.state={},e.getterCache={},e.status="resting",e.transaction=!1,e.transactionCache={},e.callbacks=[],this._processActions(t);let s=t.initialState||{};if(e.copyOfInitialState=e._copyValue(s),e.ttl=-1,e.lastUpdatedState={},t.ttl&&(e.ttl=t.ttl,Object.keys(e.copyOfInitialState).forEach((t=>e.lastUpdatedState[t]=(new Date).getTime()))),e.persist=void 0,t.persist){e.persist="string"==typeof t.persist?createPersist(t.persist):t.persist;const i=e.persist.getState(),r=e.persist.lastUpdated();i&&r&&(-1===e.ttl||e._lastUpdatedTimeDiff(r)<e.ttl)&&(s=i)}this._processState(s)}_processActions(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]||"function"!=typeof t[s]||(e[s]=t[s].bind(e))}))}_processState(t){const e=this;e.state=new Proxy(t,{set:(t,s,i)=>(e.transaction&&!e.transactionCache[s]&&(e.transactionCache[s]=e._copyValue(t[s])),t[s]=i,e.lastUpdatedState[s]=(new Date).getTime(),e.getterCache={},e.transaction||(e.persist&&e.persist.setState(e.state),e.status="resting",e._processCallbacks(e.state)),!0),get:(t,s)=>e.ttl>-1&&e._lastUpdatedTimeDiff(e.lastUpdatedState[s])>e.ttl?(e.persist&&e.persist.removeState(),e.copyOfInitialState[s]):t[s]})}_lastUpdatedTimeDiff(t){return Math.round((new Date).getTime()-t)}setState(t){const setter=t=>{if(!t||"object"!=typeof t)return;const e=this.transaction;e||(this.transactionCache={},this.transaction=!0);for(const e in t)this.state[e]&&this.state[e]===t[e]||(this.state[e]=t[e]);e||(this.transaction=!1,this.persist&&this.persist.setState(this.state),this._processCallbacks(this.state))},e=t(this.state);isPromise$1(e)?e.then(setter):setter(e)}getState(t){if(t&&("string"==typeof t||"function"==typeof t)){if(!this.getterCache[t]){let e;if("function"==typeof t)e=t(this.state);else{e=(Array.isArray(t)?t:t.match(/([^[.\]])+/g)).reduce(((t,e)=>t&&t[e]),this.state)}if(null==e)return;this.getterCache[t]=e}return this.getterCache[t]}}_processCallbacks(t){return!!this.callbacks.length&&(this.callbacks.forEach((e=>e(t))),!0)}subscribe(t){if("function"!=typeof t)throw new Error("Dude, you can only subscribe to store changes with a valid function");return this.callbacks.includes(t)||this.callbacks.push(t),()=>{this.callbacks=this.callbacks.filter((e=>e!==t))}}_copyValue(t){return t?JSON.parse(JSON.stringify(t)):t}clear(t=!0){this.getterCache={},this.transactionCache={},this.lastUpdatedState={},this.persist&&this.persist.removeState(),this.transaction=!0,this.status="clear";const e=this._copyValue(this.copyOfInitialState);for(const t in e)this.state[t]=e[t];this.transaction=!1,this.status="resting",t&&this._processCallbacks(this.state)}}function createAppState(t,e){let s=getAppState(t);return s||(s=new o(e),globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.store=globalThis.__ficusjs__.store||{},globalThis.__ficusjs__.store[t]=s,s)}function getAppState(t){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.store&&globalThis.__ficusjs__.store[t])return globalThis.__ficusjs__.store[t]}class c{constructor(){if(globalThis.__ficusjs__&&globalThis.__ficusjs__.i18n)return globalThis.__ficusjs__.i18n;this.registry={},this.currentLocale="en",this.interpolateRE=/{{\s*(\w+)\s*}}/g,this.pluralizationRules={en:{pluralizeTo:"count",getVariationIndex:t=>1===t?0:1}},this._init(),globalThis.__ficusjs__=globalThis.__ficusjs__||{},globalThis.__ficusjs__.i18n=globalThis.__ficusjs__.i18n||this}_init(){if("undefined"!=typeof window&&"undefined"!=typeof document){const t=new URLSearchParams(window.location.search).get("lang"),e=t||(document.documentElement.lang?document.documentElement.lang:navigator.language);e&&this.setLocale(e)}}_translatePlural(t,e,s,i,r){const n=this.pluralizationRules[i],a=Object.keys(s),o=1===a.length?a[0]:r||n.pluralizeTo,c=parseFloat(s[o]);if(isNaN(c))throw new Error(`Translation pluralization missing parameters on key '${t}'`);return this._interpolate(e[n.getVariationIndex(c)],s)}_interpolate(t,e){return e?t.replace(this.interpolateRE,(function(t,s){return null!=e[s]?e[s]:t})):t}t(t,e,s){const i=(s=s||{}).locale||this.currentLocale,r=s.registry||this.registry,n=r[i]&&r[i][t];return void 0===n?this.whenUndefined(t,i):Array.isArray(n)?this._translatePlural(t,n,e,i,s.pluralizeTo):this._interpolate(n,e)}add(t,e,s){return e=e||this.currentLocale,this.registry[e]=this.registry[e]||{},Object.keys(t).forEach((i=>{const r=t[i],n=s?s+"."+i:i,a=typeof r;Array.isArray(r)||"string"===a||"number"===a?this.registry[e][n]=r:this.add(r,e,n)})),this}setLocale(t){return this.currentLocale=t,this}getLocale(){return this.currentLocale}interpolateWith(t){return this.interpolateRE=t,this}setPluralizationRule(t,e,s){return this.pluralizationRules[t]={pluralizeTo:s&&(s.pluralizeTo||"count"),getVariationIndex:e},this}whenUndefined(t,e){return t}clear(){return this.registry={},this}}function createI18n(){return new c}function getI18n(){return createI18n()}function use(t,{renderer:e,...s}){if(t.create&&"function"==typeof t.create)return t.create({createCustomElement:createCustomElement,renderer:e,...s,createComponent:createComponent,createEventBus:createEventBus,getEventBus:getEventBus,createAppState:createAppState,getAppState:getAppState,createPersist:createPersist,createStore:createStore,getStore:getStore,createI18n:createI18n,getI18n:getI18n,use:use})}export{s as ExtensionBuilder,createAppState,createComponent,createCustomElement,createEventBus,createI18n,createPersist,createStore,getAppState,getEventBus,getI18n,getStore,use,withBreakpointRender,withEventBus,withI18n,withLazyRender,withLocalState,withStateMachine,withStateTransactions,withStore,withStyles,withWorkerStore,withXStateService};
