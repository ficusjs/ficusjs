const s=Object.freeze({INIT:-1,NOT_STARTED:0,RUNNING:1,STOPPED:2});function withXStateService(t,e){return{...e,created(){this._subscribeCallback=()=>{this.computedCache={},this._processRender()},this.setXStateService(t),e.created&&e.created.call(this)},mounted(){this._subscribeToFsmService(!1),e.mounted&&e.mounted.call(this)},updated(){this._subscribeToFsmService(!1),e.updated&&e.updated.call(this)},removed(){this._unsubscribeFromFsmService(),e.removed&&e.removed.call(this)},setXStateService(t){this.fsm=t&&t.status!==s.INIT?t:function(t){return{_xstateService:t,get status(){return this._xstateService?this._xstateService.status:s.INIT},get state(){return this._xstateService.state},subscribe(s){return this._xstateService.subscribe(s)},send(s){this._xstateService.send(s)},start(){this._xstateService.start()}}}(t),this._fsmSubscriptionCallback=()=>{this.fsm.status===s.RUNNING&&this._fsmSubscription&&this._subscribeCallback()},this._subscribeToFsmService()},_startFsmService(){this.fsm&&this._fsmSubscription&&this.fsm.status===s.NOT_STARTED&&this.fsm.start()},_subscribeToFsmService(t=!0){this.fsm&&this.fsm.status!==s.INIT&&!this._fsmSubscription&&(this._fsmSubscription=this.fsm.subscribe(this._fsmSubscriptionCallback),t&&this._fsmSubscriptionCallback(),this._startFsmService())},_unsubscribeFromFsmService(){this.fsm&&this.fsm.status!==s.INIT&&this._fsmSubscription&&"function"==typeof this._fsmSubscription&&(this._fsmSubscription(),this._fsmSubscription=null)}}}export{withXStateService};
